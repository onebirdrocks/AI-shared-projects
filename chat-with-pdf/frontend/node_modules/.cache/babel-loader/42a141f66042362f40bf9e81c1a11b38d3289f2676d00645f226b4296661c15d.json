{"ast":null,"code":"import React,{useState,useEffect,useRef}from'react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Chat=_ref=>{let{fileName}=_ref;const[messages,setMessages]=useState([]);const[input,setInput]=useState('');const[ws,setWs]=useState(null);const chatContainerRef=useRef(null);useEffect(()=>{const websocket=new WebSocket('ws://localhost:8000/ws');setWs(websocket);websocket.onmessage=event=>{const data=JSON.parse(event.data);if(data.response){setMessages(prev=>[...prev,{role:'assistant',content:data.response}]);}};return()=>{websocket.close();};},[]);useEffect(()=>{if(chatContainerRef.current){chatContainerRef.current.scrollTop=chatContainerRef.current.scrollHeight;}},[messages]);const sendMessage=()=>{if(input.trim()&&ws){const newMessage={role:'user',content:input};setMessages(prev=>[...prev,newMessage]);ws.send(JSON.stringify({query:input,file_name:fileName,chat_history:messages}));setInput('');}};return/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col h-full\",children:[/*#__PURE__*/_jsx(\"div\",{ref:chatContainerRef,className:\"flex-grow overflow-auto mb-4 p-4 bg-white rounded-lg shadow\",children:messages.map((message,index)=>/*#__PURE__*/_jsx(\"div\",{className:`mb-4 ${message.role==='user'?'text-right':'text-left'}`,children:/*#__PURE__*/_jsx(\"span\",{className:`inline-block p-2 rounded-lg ${message.role==='user'?'bg-blue-500 text-white':'bg-gray-200 text-black'}`,children:message.content})},index))}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:input,onChange:e=>setInput(e.target.value),onKeyPress:e=>e.key==='Enter'&&sendMessage(),className:\"flex-grow border border-gray-300 rounded-l-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500\",placeholder:\"\\u8F93\\u5165\\u60A8\\u7684\\u95EE\\u9898...\"}),/*#__PURE__*/_jsx(\"button\",{onClick:sendMessage,className:\"bg-blue-500 text-white px-4 py-2 rounded-r-lg hover:bg-blue-600 transition duration-300\",children:\"\\u53D1\\u9001\"})]})]});};export default Chat;","map":{"version":3,"names":["React","useState","useEffect","useRef","jsx","_jsx","jsxs","_jsxs","Chat","_ref","fileName","messages","setMessages","input","setInput","ws","setWs","chatContainerRef","websocket","WebSocket","onmessage","event","data","JSON","parse","response","prev","role","content","close","current","scrollTop","scrollHeight","sendMessage","trim","newMessage","send","stringify","query","file_name","chat_history","className","children","ref","map","message","index","type","value","onChange","e","target","onKeyPress","key","placeholder","onClick"],"sources":["/Users/onebird/Desktop/chat_with_pdf_by_cursor/frontend/src/components/Chat.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\n\ninterface Message {\n  role: 'user' | 'assistant';\n  content: string;\n}\n\ninterface ChatProps {\n  fileName: string;\n}\n\nconst Chat: React.FC<ChatProps> = ({ fileName }) => {\n  const [messages, setMessages] = useState<Message[]>([]);\n  const [input, setInput] = useState('');\n  const [ws, setWs] = useState<WebSocket | null>(null);\n  const chatContainerRef = useRef<HTMLDivElement>(null);\n\n  useEffect(() => {\n    const websocket = new WebSocket('ws://localhost:8000/ws');\n    setWs(websocket);\n\n    websocket.onmessage = (event) => {\n      const data = JSON.parse(event.data);\n      if (data.response) {\n        setMessages(prev => [...prev, { role: 'assistant', content: data.response }]);\n      }\n    };\n\n    return () => {\n      websocket.close();\n    };\n  }, []);\n\n  useEffect(() => {\n    if (chatContainerRef.current) {\n      chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;\n    }\n  }, [messages]);\n\n  const sendMessage = () => {\n    if (input.trim() && ws) {\n      const newMessage: Message = { role: 'user', content: input };\n      setMessages(prev => [...prev, newMessage]);\n      ws.send(JSON.stringify({ query: input, file_name: fileName, chat_history: messages }));\n      setInput('');\n    }\n  };\n\n  return (\n    <div className=\"flex flex-col h-full\">\n      <div ref={chatContainerRef} className=\"flex-grow overflow-auto mb-4 p-4 bg-white rounded-lg shadow\">\n        {messages.map((message, index) => (\n          <div key={index} className={`mb-4 ${message.role === 'user' ? 'text-right' : 'text-left'}`}>\n            <span className={`inline-block p-2 rounded-lg ${message.role === 'user' ? 'bg-blue-500 text-white' : 'bg-gray-200 text-black'}`}>\n              {message.content}\n            </span>\n          </div>\n        ))}\n      </div>\n      <div className=\"flex\">\n        <input\n          type=\"text\"\n          value={input}\n          onChange={(e) => setInput(e.target.value)}\n          onKeyPress={(e) => e.key === 'Enter' && sendMessage()}\n          className=\"flex-grow border border-gray-300 rounded-l-lg p-2 focus:outline-none focus:ring-2 focus:ring-blue-500\"\n          placeholder=\"输入您的问题...\"\n        />\n        <button \n          onClick={sendMessage}\n          className=\"bg-blue-500 text-white px-4 py-2 rounded-r-lg hover:bg-blue-600 transition duration-300\"\n        >\n          发送\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default Chat;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}